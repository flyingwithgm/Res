import React, { useState, useEffect, useRef } from 'react';
import { 
  Download, 
  Save, 
  Upload, 
  User, 
  Mail, 
  Phone, 
  MapPin, 
  Briefcase, 
  GraduationCap, 
  Award, 
  Globe, 
  Sun, 
  Moon, 
  Plus, 
  Trash2, 
  Sparkles, 
  FileText, 
  Logo,
  Bold,
  Italic,
  Underline,
  AlignLeft,
  AlignCenter,
  AlignRight,
  List,
  ListOrdered,
  Undo,
  Redo,
  Settings,
  LogOut,
  Eye,
  Copy,
  Check
} from 'lucide-react';

const App = () => {
  const [darkMode, setDarkMode] = useState(false);
  const [currentUser, setCurrentUser] = useState(null);
  const [currentTemplate, setCurrentTemplate] = useState('professional');
  const [resumeData, setResumeData] = useState({
    personalInfo: {
      name: '',
      email: '',
      phone: '',
      address: '',
      summary: ''
    },
    experience: [],
    education: [],
    projects: [],
    references: [],
    skills: []
  });
  const [activeSection, setActiveSection] = useState('personal');
  const [isSaving, setIsSaving] = useState(false);
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [authMode, setAuthMode] = useState('signin');
  const [authError, setAuthError] = useState('');
  const [isPreviewMode, setIsPreviewMode] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [editorContent, setEditorContent] = useState('');
  const [toolbarVisible, setToolbarVisible] = useState(false);
  const editorRef = useRef(null);

  // Mock Firebase initialization
  const firebaseConfig = {
    apiKey: "AIzaSyB-knioaiQM20qRyOaDTcW03ct1VCQZ498",
    authDomain: "gmart-9c0eb.firebaseapp.com",
    projectId: "gmart-9c0eb",
    storageBucket: "gmart-9c0eb.firebasestorage.app",
    messagingSenderId: "592445088436",
    appId: "1:592445088436:web:0f37b6344d6124e765ede1"
  };

  // Initialize dark mode from system preference
  useEffect(() => {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    setDarkMode(prefersDark);
  }, []);

  // Apply dark mode class to body
  useEffect(() => {
    if (darkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [darkMode]);

  // Handle authentication
  const handleAuth = async (email, password) => {
    try {
      // Mock authentication - in real app, this would call Firebase
      setCurrentUser({ email, uid: 'mock-user-id' });
      setShowAuthModal(false);
      setAuthError('');
    } catch (error) {
      setAuthError('Authentication failed. Please try again.');
    }
  };

  const handleLogout = () => {
    setCurrentUser(null);
  };

  // Update resume data
  const updateResumeData = (section, field, value) => {
    setResumeData(prev => ({
      ...prev,
      [section]: {
        ...prev[section],
        [field]: value
      }
    }));
  };

  const addExperience = () => {
    setResumeData(prev => ({
      ...prev,
      experience: [...prev.experience, { id: Date.now(), position: '', company: '', startDate: '', endDate: '', description: '' }]
    }));
  };

  const removeExperience = (id) => {
    setResumeData(prev => ({
      ...prev,
      experience: prev.experience.filter(exp => exp.id !== id)
    }));
  };

  const updateExperience = (id, field, value) => {
    setResumeData(prev => ({
      ...prev,
      experience: prev.experience.map(exp => 
        exp.id === id ? { ...exp, [field]: value } : exp
      )
    }));
  };

  const addEducation = () => {
    setResumeData(prev => ({
      ...prev,
      education: [...prev.education, { id: Date.now(), school: '', degree: '', startDate: '', endDate: '' }]
    }));
  };

  const removeEducation = (id) => {
    setResumeData(prev => ({
      ...prev,
      education: prev.education.filter(edu => edu.id !== id)
    }));
  };

  const updateEducation = (id, field, value
